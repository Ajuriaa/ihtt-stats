<app-loading class="loading" *ngIf="loading"></app-loading>

<div class="container">
  <div class="filter-wrapper">
    <div class="filter-row">
      <!-- Filtros de fecha -->
      <app-date-filter
        [showDateTypeFilter]="false"
        (dateRangeChanged)="filterDates($event)">
      </app-date-filter>

      <!-- Estado del Permiso -->
      <mat-form-field>
        <mat-label>Estado del Permiso</mat-label>
        <mat-select [(value)]="selectedPermitStatus" (selectionChange)="applyFilter('permitStatus', $event.value)">
          <mat-option value="">TODOS</mat-option>
          <mat-option *ngFor="let status of permitStatuses" [value]="status">{{ status }}</mat-option>
        </mat-select>
      </mat-form-field>

      <!-- Tipo de Servicio -->
      <mat-form-field>
        <mat-label>Tipo de Servicio</mat-label>
        <mat-select [(value)]="selectedServiceType" (selectionChange)="applyFilter('serviceType', $event.value)">
          <mat-option value="">TODOS</mat-option>
          <mat-option *ngFor="let serviceType of serviceTypes" [value]="serviceType">{{ serviceType }}</mat-option>
        </mat-select>
      </mat-form-field>

      <!-- Oficina Regional -->
      <mat-form-field>
        <mat-label>Oficina Regional</mat-label>
        <mat-select [(value)]="selectedRegionalOffice" (selectionChange)="applyFilter('regionalOffice', $event.value)">
          <mat-option value="">TODAS</mat-option>
          <mat-option *ngFor="let office of regionalOffices" [value]="office">{{ office }}</mat-option>
        </mat-select>
      </mat-form-field>

            <!-- Origen de Creación -->
      <mat-form-field>
        <mat-label>Origen de Creación</mat-label>
        <mat-select [(value)]="selectedCreationOrigin" (selectionChange)="applyFilter('creationOrigin', $event.value)">
          <mat-option value="">TODOS</mat-option>
          <mat-option *ngFor="let origin of creationOrigins" [value]="origin">{{ origin }}</mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    <div class="filter-row">
      <!-- RTN del Solicitante -->
      <mat-form-field>
        <input matInput placeholder="RTN del Solicitante" [(ngModel)]="rtn">
      </mat-form-field>

      <!-- Nombre del Solicitante -->
      <mat-form-field>
        <input matInput placeholder="Nombre del Solicitante" [(ngModel)]="applicantName">
      </mat-form-field>

      <!-- Tipo de Firma -->
      <mat-form-field>
        <mat-label>Tipo de Firma</mat-label>
        <mat-select [(value)]="selectedSignatureType" (selectionChange)="applyFilter('signatureType', $event.value)">
          <mat-option value="">TODOS</mat-option>
          <mat-option *ngFor="let sigType of signatureTypes" [value]="sigType">{{ sigType }}</mat-option>
        </mat-select>
      </mat-form-field>

      <!-- Tipo PETI -->
      <mat-form-field>
        <mat-label>Tipo PETI</mat-label>
        <mat-select [(value)]="selectedPetiType" (selectionChange)="applyFilter('petiType', $event.value)">
          <mat-option value="">TODOS</mat-option>
          <mat-option *ngFor="let peti of petiTypes" [value]="peti">{{ peti }}</mat-option>
        </mat-select>
      </mat-form-field>

      <app-primary-button (click)="fetchDashboard()">FILTRAR</app-primary-button>
    </div>
  </div>

  <div class="kpi-container">
    <mat-card class="kpi-card">
      <p class="title">{{ totalPermits | number }}</p>
      <p>Total Permisos Eventuales</p>
    </mat-card>

    <mat-card class="kpi-card">
      <p class="title">{{ totalRevenue | currency:'HNL':'L.':'2.2' }}</p>
      <p>Total Pagado por Permisos</p>
    </mat-card>

    <mat-card class="kpi-card">
      <p class="title">{{ deliveredPermits | number }}</p>
      <p>Permisos Entregados</p>
    </mat-card>

    <mat-card class="kpi-card">
      <p class="title">{{ totalOwed | currency:'HNL':'L.':'2.2' }}</p>
      <p>Total Adeudado por Permisos Activos</p>
    </mat-card>
  </div>

  <!-- Global KPIs Section -->
  <div class="kpi-container">
    <mat-card class="kpi-card">
      <p class="title">{{ globalTotalPermits | number }}</p>
      <p>Total Permisos (Global)</p>
    </mat-card>

    <mat-card class="kpi-card">
      <p class="title">{{ globalTotalRevenue | currency:'HNL':'L.':'2.2' }}</p>
      <p>Ingresos Totales (Global)</p>
    </mat-card>

    <mat-card class="kpi-card">
      <p class="title">{{ globalTotalOwed | currency:'HNL':'L.':'2.2' }}</p>
      <p>Total Adeudado (Global)</p>
    </mat-card>

    <mat-card class="kpi-card">
      <p class="title">{{ globalDeliveredPermits | number }}</p>
      <p>Permisos Entregados (Global)</p>
    </mat-card>
  </div>

  <div class="graph-container">
    <div id="statusDistributionChart" style="width: 40%; height: 400px;"></div>
    <div id="monthlyRevenueChart" style="width: 60%; height: 400px;"></div>
  </div>

  <div id="revenueByStatusChart" style="width: 100%; height: 400px;"></div>

  <div class="graph-container">
    <div id="serviceTypeChart" style="width: 40%; height: 400px;"></div>
    <div id="regionalOfficeChart" style="width: 60%; height: 400px;"></div>
  </div>
</div>
