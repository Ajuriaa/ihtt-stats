<app-loading class="loading" *ngIf="loading"></app-loading>

<div class="container">
  <div class="filter-wrapper">
    <div class="filter-row">
      <app-date-filter [showDateTypeFilter]="true" (dateRangeChanged)="filterDates($event)"></app-date-filter>
      <!-- Estado de Solicitud -->
      <mat-form-field>
        <mat-label>Estado de Solicitud</mat-label>
        <mat-select [(ngModel)]="selectedFileStatus" (selectionChange)="applyFilter('fileStatus', $event.value)">
          <mat-option value="">TODOS</mat-option>
          <mat-option *ngFor="let status of fileStatuses" [value]="status">
            {{ status }}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <!-- Tipo de Trámite -->
      <mat-form-field>
        <mat-label>Tipo de Trámite</mat-label>
        <mat-select [(ngModel)]="selectedProcedureType" (selectionChange)="applyFilter('procedureType', $event.value)">
          <mat-option value="">TODOS</mat-option>
          <mat-option *ngFor="let type of procedureTypes" [value]="type">
            {{ type }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    <div class="filter-row">
      <!-- Categoría -->
      <mat-form-field>
        <mat-label>Categoría</mat-label>
        <mat-select [(ngModel)]="selectedCategory" (selectionChange)="applyFilter('category', $event.value)">
          <mat-option value="">TODAS</mat-option>
          <mat-option *ngFor="let category of categories" [value]="category">
            {{ category }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <!-- Nombre del Solicitante -->
      <mat-form-field>
        <input matInput placeholder="Nombre del Solicitante" [(ngModel)]="applicantName">
      </mat-form-field>

      <!-- Nombre de la Empresa -->
      <mat-form-field>
        <input matInput placeholder="Nombre de la Empresa" [(ngModel)]="companyName">
      </mat-form-field>

      <!-- Renovación automática -->
      <mat-form-field>
        <mat-label>Renovación Automática</mat-label>
        <mat-select [(ngModel)]="selectedRenewalState" (selectionChange)="applyFilter('renewalState', $event.value)">
          <mat-option value="">TODOS</mat-option>
          <mat-option *ngFor="let estado of renewalStates" [value]="estado.value">
            {{ estado.label }}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <app-primary-button (btnClick)="onSubmit()">FILTRAR</app-primary-button>
    </div>
  </div>

  <div class="kpi-container">
    <mat-card class="kpi-card">
      <p class="title">{{ totalApplications }}</p>
      <p>Total de Solicitudes</p>
    </mat-card>

    <mat-card class="kpi-card">
      <p class="title">{{ pendingApplications }}</p>
      <p>Solicitudes Pendientes</p>
    </mat-card>

    <mat-card class="kpi-card">
      <p class="title">{{ approvedApplications }}</p>
      <p>Solicitudes Aprobadas</p>
    </mat-card>

    <mat-card class="kpi-card">
      <p class="title">{{ rejectedApplications }}</p>
      <p>Solicitudes Rechazadas</p>
    </mat-card>
  </div>

  <div class="graph-container">
    <div id="statusDistributionChart" style="width: 40%; height: 400px;"></div>
    <div id="monthlyApplicationsChart" style="width: 60%; height: 400px;"></div>
  </div>
  
  <div id="procedureTypeChart" style="width: 100%; height: 400px;"></div>
  
  <div class="graph-container">
    <div id="renewalTypeChart" style="width: 40%; height: 400px;"></div>
    <div id="serviceClassChart" style="width: 60%; height: 400px;"></div>
  </div>

  <div class="kpi-container">
    <mat-card class="kpi-card">
      <p class="title">{{ automaticRenewals }}</p>
      <p>Renovaciones Automáticas</p>
    </mat-card>

    <mat-card class="kpi-card">
      <p class="title">{{ manualApplications }}</p>
      <p>Solicitudes Manuales</p>
    </mat-card>
  </div>
</div>